[[geopoints]]
== 地理点

一个地理点（ _geo-point_ ）代表地球表面一个经纬度点。Geo-points 类型支持计算点与点之间的距离、判定一个点是否在一个包围盒或者一个聚合条件之内。

<<dynamic-mapping,Dynamic mapping>>（动态 mapping）无法自动探测出哪个字段中存储的是 `geo-point` 类型的数据，因此，需要在 mapping 中显式地声明每个 `geo-point` 字段。

[source,json]
-----------------------
PUT /attractions
{
  "mappings": {
    "restaurant": {
      "properties": {
        "name": {
          "type": "string"
        },
        "location": {
          "type": "geo_point"
        }
      }
    }
  }
}
-----------------------

[[lat-lon-formats]]
[float="true"]
=== 经纬度格式

`location` 被定义为 `geo_point` 类型之后，我们就可以继续对包含纬度/经度数据对的文档进行索引。其中，纬度/经度数据对可以定义成字符串、数组或者对象的形式。

[role="pagebreak-before"]
[source,json]
-----------------------
PUT /attractions/restaurant/1
{
  "name":     "Chipotle Mexican Grill",
  "location": "40.715, -74.011" <1>
}

PUT /attractions/restaurant/2
{
  "name":     "Pala Pizza",
  "location": { <2>
    "lat":     40.722,
    "lon":    -73.989
  }
}

PUT /attractions/restaurant/3
{
  "name":     "Mini Munchies Pizza",
  "location": [ -73.983, 40.719 ] <3>
}
-----------------------
<1> 字符串形式表示， `"lat,lon"` 。
<2> 对象形式表示， `lat` 和 `lon` 必须显式命名。
<3> 数组形式表示， `[lon,lat]` 。


[CAUTION]
========================

每个人都要注意：字符串形式的 geo-points 是以 `"纬度，经度"`
地顺序组织，但是数组形式的 geo-points 却正好相反——以 `[经度，纬度]` 地顺序组织！

起初，Elasticsearch 中字符串和数组形式的 geo-points 都是以纬度在前经度在后地方式组织。但是，早期为了保持和 GeoJSON 的一致，数组形式的 geo-points 被变成了
`[经度，纬度]` 的顺序。

结果导致一些没有注意到这个区别的使用者陷入了地理位置的噩梦。

========================

